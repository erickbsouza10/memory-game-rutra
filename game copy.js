const logos=["assets/logos/bandeira.svg","assets/logos/cavalo.svg","assets/logos/campina_grill.svg","assets/logos/gourmet.svg","assets/logos/concept.svg","assets/logos/denim.svg"];let gameStarted=!1;const winModal=document.getElementById("win-modal"),restartBtn=document.getElementById("restart-btn"),loseModal=document.getElementById("lose-modal"),loseRestartBtn=document.getElementById("lose-restart-btn");let gameEnded=!1;const pizzaTimer=document.getElementById("pizza-timer"),pizzaFill=document.getElementById("pizza-fill"),pizzaHand=document.getElementById("pizza-hand");let startTime=0,totalDuration=0;function playVideoInModal(e){if(!e)return;const t=e.querySelector("video");if(!t)return;t.currentTime=0,t.muted=!0;const a=t.play();a&&a.catch((e=>console.warn("Erro ao iniciar vÃ­deo:",e)))}const board=document.getElementById("board");let cards=[],firstCard=null,lockBoard=!1;function shuffleCards(){cards=[...logos,...logos].sort((()=>Math.random()-.5))}const timerEl=document.getElementById("game-timer"),timeValueEl=document.getElementById("time-value");let timerInterval=null;function polarToCartesian(e,t,a,s){const n=(s-90)*Math.PI/180;return{x:e+a*Math.cos(n),y:t+a*Math.sin(n)}}function describeSector(e,t,a,s){if(s<=0)return"";const n=polarToCartesian(e,t,a,0),i=polarToCartesian(e,t,a,s),r=s>180?1:0;return`\n    M ${e} ${t}\n    L ${n.x} ${n.y}\n    A ${a} ${a} 0 ${r} 1 ${i.x} ${i.y}\n    Z\n  `}function startGameTimer(e=20){clearInterval(timerInterval),totalDuration=1e3*e,startTime=performance.now(),pizzaTimer.classList.remove("hidden","danger"),timerEl.classList.remove("hidden","danger"),pizzaHand.style.transform="rotate(0deg)",timerInterval=setInterval((()=>{if(gameEnded)return void clearInterval(timerInterval);const e=performance.now()-startTime;let t=totalDuration-e;t<0&&(t=0);const a=Math.floor(t/1e3),s=Math.floor(t%1e3/10);document.getElementById("time-seconds").textContent=a,document.getElementById("time-cents").textContent=String(s).padStart(2,"0");const n=360*Math.min(e/totalDuration,1);pizzaHand.style.transform=`rotate(${n}deg)`,t<=5e3&&(pizzaTimer.classList.add("danger"),timerEl.classList.add("danger")),t<=0&&(clearInterval(timerInterval),handleGameOver())}),40)}function handleGameOver(){gameEnded||(gameEnded=!0,gameStarted=!1,lockBoard=!0,clearInterval(timerInterval),pizzaTimer.classList.add("hidden"),timerEl.classList.add("hidden"),confetti({particleCount:120,spread:100,origin:{y:.6},colors:["#e74c3c","#922b21"]}),setTimeout((()=>{loseModal.classList.add("active"),requestAnimationFrame((()=>{playVideoInModal(loseModal)}))}),600))}function createBoard(){board.innerHTML="",cards.forEach(((e,t)=>{const a=document.createElement("div");a.classList.add("card"),e.includes("cavalo")&&a.classList.add("is-cavalo"),e.includes("bandeira")&&a.classList.add("is-bandeira"),e.includes("campina_grill")&&a.classList.add("is-grill"),e.includes("gourmet")&&a.classList.add("is-gourmet"),e.includes("concept")&&a.classList.add("is-concept"),e.includes("denim")&&a.classList.add("is-denim"),a.innerHTML=`\n      <div class="card-inner">\n        <div class="card-front"></div>\n        <div class="card-back">\n          <img src="${e}" alt="logo" />\n        </div>\n      </div>\n    `,a.addEventListener("click",(()=>flipCard(a))),board.appendChild(a),requestAnimationFrame((()=>{setTimeout((()=>{a.classList.add("animate-in")}),60*t)}))}))}function aplicarPremio(e){const t=document.getElementById("premio-nome"),a=document.getElementById("copo-video-win");a&&(e<=15?(t.textContent="Copo Rutra Premium",winModal.classList.add("premium-win")):(t.textContent="Copo Rutra",winModal.classList.remove("premium-win")),a.currentTime=0,a.muted=!0,a.play().catch((()=>{})))}function setupVideoOnce(e){const t=document.getElementById(e);t&&t.addEventListener("ended",(()=>{t.pause()}))}function checkWin(){if(document.querySelectorAll(".card.matched").length!==cards.length||gameEnded)return;gameEnded=!0,gameStarted=!1,lockBoard=!0,clearInterval(timerInterval);const e=performance.now();elapsedTimeMs=e-startTime,remainingTimeMs=Math.max(totalDuration-elapsedTimeMs,0);const t=Math.round(elapsedTimeMs/1e3),a=Math.floor(remainingTimeMs/1e3);document.getElementById("tempo-levado").textContent=t,aplicarPremio(a),pizzaTimer.classList.add("hidden"),timerEl.classList.add("hidden"),confetti({particleCount:300,spread:120,origin:{y:.6},colors:["#223066","#ffffff","#f1c40f"]}),setTimeout((()=>{winModal.classList.add("active"),requestAnimationFrame((()=>{playVideoInModal(loseModal)}))}),600)}function autoFinishLastPair(){const e=document.querySelectorAll(".card:not(.matched):not(.flipped)");if(2===e.length){lockBoard=!0;const[t,a]=e;t.classList.add("flipped"),a.classList.add("flipped"),setTimeout((()=>{t.classList.add("matched","celebrate"),a.classList.add("matched","celebrate"),confetti({particleCount:180,spread:100,origin:{y:.6},colors:["#223066","#ffffff","#f1c40f"]}),setTimeout((()=>{t.classList.remove("celebrate"),a.classList.remove("celebrate"),checkWin()}),600)}),400)}}function flipCard(e){gameStarted&&(lockBoard||e.classList.contains("flipped")||e.classList.contains("matched")||(e.classList.add("flipped"),firstCard?checkMatch(e):firstCard=e))}function checkMatch(e){firstCard.querySelector("img").src===e.querySelector("img").src?(firstCard.classList.add("matched","celebrate"),e.classList.add("matched","celebrate"),confetti({particleCount:120,spread:80,origin:{y:.6},colors:["#223066","#ffffff"]}),setTimeout((()=>{firstCard.classList.remove("celebrate"),e.classList.remove("celebrate")}),600),resetTurn(),autoFinishLastPair(),checkWin()):(lockBoard=!0,setTimeout((()=>{firstCard.classList.remove("flipped"),e.classList.remove("flipped"),resetTurn()}),800))}function resetTurn(){firstCard=null,lockBoard=!1}setupVideoOnce("copo-video-win"),setupVideoOnce("copo-video-lose");const startScreen=document.getElementById("start-screen"),startButton=document.getElementById("start-button");function restartGame(){gameStarted=!1,lockBoard=!1,firstCard=null,winModal.classList.remove("active"),board.classList.remove("active"),board.innerHTML="",setTimeout((()=>{shuffleCards(),createBoard()}),200),setTimeout((()=>{gameStarted=!0,board.classList.add("active")}),600)}startButton.addEventListener("click",(()=>{gameEnded=!1,startScreen.classList.add("hidden"),setTimeout((()=>{shuffleCards(),createBoard()}),200),setTimeout((()=>{board.classList.add("active"),gameStarted=!0,setTimeout((()=>{startGameTimer(60)}),1e3)}),200+60*cards.length+300)})),restartBtn.addEventListener("click",(()=>{window.location.reload()})),loseRestartBtn.addEventListener("click",(()=>{loseModal.classList.remove("active"),window.location.reload()})),window.addEventListener("load",(()=>{const e=document.getElementById("preloader");e&&setTimeout((()=>{e.classList.add("hidden")}),300)}));